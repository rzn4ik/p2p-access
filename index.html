<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Вход через Telegram</title>
</head>
<body>
  <h2>Вход в закрытую систему</h2>

  <!-- Telegram Login Widget -->
  <script async src="https://telegram.org/js/telegram-widget.js?22"
          data-telegram-login="P2Pbot"
          data-size="large"
          data-userpic="false"
          data-request-access="write"
          data-onauth="onTelegramAuth">
  </script>

  <div id="status"></div>

  <script>
    async function onTelegramAuth(user) {
      document.getElementById('status').innerHTML = `Здравствуйте, ${user.first_name} (@${user.username})<br>Проверка доступа...`;

      const response = await fetch("https://ВАШ-БЭКЕНД/api/check-user", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          telegram_id: user.id,
          username: user.username
        })
      });

      if (response.ok) {
        // Допущен — переход внутрь
        window.location.href = "/dashboard";
      } else {
        document.getElementById('status').innerHTML += "<br><b>Ожидайте подтверждение администратора.</b>";
      }
    }
  </script>
</body>
</html>
